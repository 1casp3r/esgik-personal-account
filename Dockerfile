# Используем официальный образ PHP с веб-сервером Apache.
# Версия 8.2 — это актуальная и безопасная версия.
FROM php:8.2-apache

# Устанавливаем рабочую директорию внутри контейнера.
# Это стандартная директория для Apache.
WORKDIR /var/www/html

# Копируем статический сайт
COPY . ./

# Копируем PHP-маршрутизатор, который будет обрабатывать запросы.
COPY ./index.php ./

# Включаем модуль Apache для перезаписи URL.
# Это критически важно для работы PHP-маршрутизатора.
# Он позволяет перенаправлять все запросы, которые не являются файлами, на index.php.
RUN a2enmod rewrite

# Создаем файл .htaccess для правильной маршрутизации.
# Он говорит Apache, что если файл или директория не существуют,
# нужно перенаправить запрос на index.php.
# Это позволяет нашему PHP-скрипту обрабатывать все роуты, созданные Next.js.
RUN echo "RewriteEngine On\n" \
     "RewriteCond %{REQUEST_FILENAME} !-f\n" \
     "RewriteCond %{REQUEST_FILENAME} !-d\n" \
     "RewriteRule ^(.*)$ index.php [QSA,L]" > /var/www/html/.htaccess

# Устанавливаем права на файлы (необязательно, но полезно для отладки).
RUN chown -R www-data:www-data /var/www/html

# Порт 80 — стандартный порт для веб-серверов. Мы его "открываем",
# чтобы потом можно было связать с портом на вашей машине.
EXPOSE 80
