<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Личный кабинет</title>
    <!-- Подключаем Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Подключаем иконки Lucide -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Шрифт Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        /* Стили для боковой панели */
        .sidebar {
            transition: transform 0.3s ease-in-out;
            transform: translateX(-100%);
        }
        .sidebar.open {
            transform: translateX(0);
        }
        .main-content {
            transition: margin-left 0.3s ease-in-out;
        }
        /* Стили для иконок в панелях */
        .panel-icon {
            width: 1.25rem;
            height: 1.25rem;
            display: inline-block;
        }
        /* Стили для модального окна */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
        }
        .modal.open {
            display: flex;
        }
        .modal-content {
            background-color: #fefefe;
            padding: 24px;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            width: 100%;
            max-width: 500px;
            position: relative;
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col">
    <!-- Шапка -->
    <header class="bg-white shadow-sm p-4 sticky top-0 z-40">
        <div class="container mx-auto flex items-center justify-between">
            <div class="flex items-center gap-4">
                <button id="sidebar-toggle" class="md:hidden p-2 rounded-md hover:bg-gray-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
                </button>
                <div class="flex items-center gap-2">
                    <img src="https://placehold.co/40x40/5c6ac4/ffffff/png?text=L" alt="Logo" class="rounded-full">
                    <span class="text-xl font-bold text-gray-800">Личный кабинет</span>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <button id="notifications-toggle" class="relative p-2 rounded-md hover:bg-gray-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bell"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
                    <span class="absolute top-1 right-1 h-3 w-3 bg-red-500 rounded-full border-2 border-white animate-pulse"></span>
                </button>
                <button id="help-toggle" class="p-2 rounded-md hover:bg-gray-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-help-circle"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
                </button>
            </div>
        </div>
    </header>

    <div class="flex flex-1">
        <!-- Боковая панель -->
        <aside id="sidebar" class="sidebar bg-white w-64 p-6 shadow-lg md:relative md:translate-x-0 md:shadow-none fixed inset-y-0 z-50">
            <div class="flex justify-end md:hidden">
                <button id="sidebar-close" class="p-2 rounded-md hover:bg-gray-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6L6 18"/><path d="M6 6L18 18"/></svg>
                </button>
            </div>
            <nav class="space-y-4">
                <a href="#dashboard" class="flex items-center p-3 rounded-md font-medium text-gray-700 hover:bg-gray-200 tab-link active" data-tab="dashboard">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-grid mr-3 h-5 w-5"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>
                    Главная
                </a>
                <a href="#profile" class="flex items-center p-3 rounded-md font-medium text-gray-700 hover:bg-gray-200 tab-link" data-tab="profile">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-circle mr-3 h-5 w-5"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="10" r="3"/><path d="M7 20.662V19a2 2 0 012-2h6a2 2 0 012 2v1.662"/></svg>
                    Мой профиль
                </a>
                <a href="#objects" class="flex items-center p-3 rounded-md font-medium text-gray-700 hover:bg-gray-200 tab-link" data-tab="objects">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-building-2 mr-3 h-5 w-5"><path d="M6 22V4a2 2 0 012-2h8a2 2 0 012 2v18"/><path d="M6 12H4a2 2 0 01-2-2V6a2 2 0 012-2h2"/><path d="M18 10h2a2 2 0 012 2v4a2 2 0 01-2 2h-2"/><path d="M10 6h4"/><path d="M10 10h4"/><path d="M10 14h4"/><path d="M10 18h4"/></svg>
                    Мои объекты
                </a>
                <a href="#services" class="flex items-center p-3 rounded-md font-medium text-gray-700 hover:bg-gray-200 tab-link" data-tab="services">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart mr-3 h-5 w-5"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 002 1.58h9.78a2 2 0 001.95-1.57l1.65-7.43H5.12"/></svg>
                    Услуги
                </a>
                <a href="#partnership" class="flex items-center p-3 rounded-md font-medium text-gray-700 hover:bg-gray-200 tab-link" data-tab="partnership">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-handshake mr-3 h-5 w-5"><path d="M12 11h-2a2 2 0 00-2 2v2a2 2 0 002 2h2m0-4v-2m0 2h2a2 2 0 002-2v-2a2 2 0 00-2-2h-2m-2-2a2 2 0 00-2 2v2a2 2 0 002 2h2m0-4v-2m0 2h2a2 2 0 002-2v-2a2 2 0 00-2-2h-2m-2 2h2a2 2 0 002-2v-2a2 2 0 00-2-2h-2m-2-2h2a2 2 0 002-2v-2a2 2 0 00-2-2h-2m-2-2h2a2 2 0 002-2v-2a2 2 0 00-2-2h-2m-2-2h2a2 2 0 002-2v-2a2 2 0 00-2-2h-2m-2-2h2a2 2 0 002-2v-2a2 2 0 00-2-2h-2m-2-2h2a2 2 0 002-2v-2a2 2 0 00-2-2h-2"/></svg>
                    Партнерство
                </a>
            </nav>
        </aside>

        <!-- Основной контент -->
        <main id="main-content" class="main-content flex-1 p-4 md:p-8 overflow-y-auto">
            <div id="dashboard" class="tab-content active">
                <div class="space-y-6">
                    <!-- Заголовок и синхронизация -->
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-800">Главная</h1>
                            <p class="text-gray-500 mt-1">Добро пожаловать в ваш личный кабинет</p>
                        </div>
                        <div class="mt-4 sm:mt-0">
                            <button id="sync-crm-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-300 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw mr-2 h-4 w-4"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.79 2.87L3 7"/><path d="M3 3v4h4"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.79-2.87L21 17"/><path d="M21 21v-4h-4"/></svg>
                                Синхронизировать с CRM
                            </button>
                        </div>
                    </div>
                    
                    <div id="sync-result-alert" class="hidden rounded-lg border px-4 py-3 text-sm" role="alert">
                        <p></p>
                    </div>

                    <!-- Статистика -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-lg shadow-sm">
                            <div class="flex items-center justify-between">
                                <h3 class="text-sm font-medium text-gray-500">Объекты в работе</h3>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bolt-circle h-6 w-6 text-blue-500"><circle cx="12" cy="12" r="10"/><path d="M10 16l4-8-2-4v8l-4 8 2 4z"/></svg>
                            </div>
                            <p class="mt-4 text-3xl font-bold text-gray-900">12</p>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-sm">
                            <div class="flex items-center justify-between">
                                <h3 class="text-sm font-medium text-gray-500">Завершенные объекты</h3>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle-2 h-6 w-6 text-green-500"><circle cx="12" cy="12" r="10"/><path d="M8 11s2 4 4 4c.5 0 1-1 2-1s2 1 2 1"/><path d="M12 4s-1 1-1 3.5c0 2 1.5 3.5 3.5 3.5"/></svg>
                            </div>
                            <p class="mt-4 text-3xl font-bold text-gray-900">45</p>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-sm">
                            <div class="flex items-center justify-between">
                                <h3 class="text-sm font-medium text-gray-500">Общее количество</h3>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text h-6 w-6 text-purple-500"><path d="M14.5 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>
                            </div>
                            <p class="mt-4 text-3xl font-bold text-gray-900">57</p>
                        </div>
                    </div>
                    
                    <!-- Последние объекты -->
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">Последние объекты</h2>
                        <div id="objects-list-dashboard" class="space-y-4">
                            <!-- Список объектов будет загружен сюда JS -->
                        </div>
                    </div>
                </div>
            </div>

            <div id="profile" class="tab-content hidden">
                <div class="space-y-6">
                    <h1 class="text-3xl font-bold text-gray-800">Мой профиль</h1>
                    
                    <!-- Форма профиля -->
                    <div id="profile-form-container">
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">Настройка профиля</h2>
                            <form id="profile-form" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Фамилия</label>
                                        <input type="text" name="last_name" id="last_name" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Имя</label>
                                        <input type="text" name="first_name" id="first_name" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Отчество</label>
                                        <input type="text" name="middle_name" id="middle_name" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Номер телефона</label>
                                        <input type="tel" name="phone" id="phone" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Email</label>
                                        <input type="email" name="email" id="email" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2" required>
                                    </div>
                                </div>
                                <div class="space-y-6">
                                    <div>
                                        <h3 class="text-md font-semibold text-gray-800 mb-2">Способ оплаты</h3>
                                        <select id="payment-method" name="payment_method" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
                                            <option value="cash">Наличные</option>
                                            <option value="bank_transfer">Банковский перевод</option>
                                            <option value="qr_code">Оплата по QR-коду</option>
                                            <option value="invoice">По реквизитам</option>
                                        </select>
                                    </div>
                                    <div>
                                        <h3 class="text-md font-semibold text-gray-800 mb-2">Способ получения документов</h3>
                                        <select id="document-delivery" name="document_delivery" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
                                            <option value="office">В офисе</option>
                                            <option value="on_site">Доставка на объект</option>
                                            <option value="yandex">Яндекс.Доставка</option>
                                            <option value="sdek">CDEK</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="border-t pt-6">
                                    <h3 class="text-md font-semibold text-gray-800 mb-2">Промокод</h3>
                                    <div class="flex gap-2">
                                        <input type="text" id="promo-code-input" placeholder="Введите промокод" class="flex-1 p-2 border border-gray-300 rounded-md shadow-sm">
                                        <button type="button" id="apply-promo-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-300">Применить</button>
                                    </div>
                                    <p id="promo-message" class="text-sm mt-2"></p>
                                </div>
                                
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-medium mb-3">Расчет стоимости</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span>Услуга:</span>
                                            <span>Межевой план</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Стоимость:</span>
                                            <span id="total-amount">15 000 ₽</span>
                                        </div>
                                        <div id="discount-row" class="hidden flex justify-between text-green-600">
                                            <span>Скидка (<span id="discount-code"></span>):</span>
                                            <span id="discount-amount"></span>
                                        </div>
                                        <div class="border-t pt-2 flex justify-between font-medium">
                                            <span>К оплате:</span>
                                            <span id="final-amount">15 000 ₽</span>
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition duration-300">Сохранить</button>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Форма паспортных данных -->
                    <div id="personal-data-form-container">
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">Паспортные данные</h2>
                            <form id="personal-data-form" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Серия паспорта</label>
                                        <input type="text" name="passport_series" id="passport_series" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Номер паспорта</label>
                                        <input type="text" name="passport_number" id="passport_number" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Кем выдан</label>
                                        <input type="text" name="passport_issued_by" id="passport_issued_by" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Дата выдачи</label>
                                        <input type="date" name="passport_issued_date" id="passport_issued_date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2">
                                    </div>
                                </div>
                                <div class="space-y-2">
                                    <label class="block text-sm font-medium text-gray-700">Адрес регистрации</label>
                                    <textarea name="passport_registration_address" id="passport_registration_address" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2"></textarea>
                                </div>
                                <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition duration-300">Сохранить</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div id="objects" class="tab-content hidden">
                <div class="space-y-6">
                    <h1 class="text-3xl font-bold text-gray-800">Мои объекты</h1>
                    <div id="objects-list">
                        <!-- Список объектов будет загружен сюда JS -->
                    </div>
                </div>
            </div>

            <div id="services" class="tab-content hidden">
                <div class="space-y-6">
                    <h1 class="text-3xl font-bold text-gray-800">Услуги</h1>
                    <div id="services-catalog">
                        <!-- Каталог услуг будет загружен сюда JS -->
                    </div>
                </div>
            </div>
            
            <div id="partnership" class="tab-content hidden">
                <div class="space-y-6">
                    <h1 class="text-3xl font-bold text-gray-800">Партнерство</h1>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Форма добавления клиента -->
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">Добавить нового клиента</h2>
                            <form id="add-client-form" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">ФИО клиента</label>
                                    <input type="text" name="client_name" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2" placeholder="Иванов Иван Иванович" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Телефон клиента</label>
                                    <input type="tel" name="client_phone" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2" placeholder="+7 (999) 999-99-99" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Адрес объекта</label>
                                    <textarea name="object_address" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2" placeholder="г. Орехово-Зуево, ул. Ленина, д. 10"></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Комментарий</label>
                                    <textarea name="comment" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2"></textarea>
                                </div>
                                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-300 flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-plus mr-2 h-4 w-4"><path d="M16 21v-2a4 4 0 00-4-4H6a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="18" x2="18" y1="10" y2="16"/><line x1="15" x2="21" y1="13" y2="13"/></svg>
                                    Добавить клиента
                                </button>
                            </form>
                        </div>
                        
                        <!-- Информация для партнеров -->
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4">Информация для партнеров</h2>
                            <div class="space-y-4 text-sm text-gray-600">
                                <div>
                                    <h4 class="font-medium text-gray-800 mb-2">Как работает партнерская программа?</h4>
                                    <p>
                                        Вы получаете комиссию за каждый заказ, оформленный привлеченным вами клиентом. Все заказы автоматически закрепляются за вами.
                                    </p>
                                </div>
                                <div>
                                    <h4 class="font-medium text-gray-800 mb-2">Какой размер комиссии?</h4>
                                    <p>
                                        Размер комиссии зависит от типа услуги и объема работ. Обычно составляет от 5% до 15% от стоимости заказа.
                                    </p>
                                </div>
                                <div>
                                    <h4 class="font-medium text-gray-800 mb-2">Как добавить контрагента?</h4>
                                    <p>
                                        Перейдите в раздел "Мои контрагенты" и нажмите "Добавить контрагента". Заполните персональные данные вашего клиента.
                                    </p>
                                </div>
                                <div>
                                    <h4 class="font-medium text-gray-800 mb-2">Когда выплачивается комиссия?</h4>
                                    <p>
                                        Комиссия начисляется после завершения работ и может быть выведена по запросу. Минимальная сумма для вывода - 1000 рублей.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Панель уведомлений (скрыта по умолчанию) -->
    <div id="notification-panel" class="absolute top-0 right-0 z-50 w-96 max-w-full hidden">
        <div class="bg-white rounded-lg shadow-lg">
            <div class="flex items-center justify-between p-4 border-b">
                <h2 class="flex items-center gap-2 text-lg font-semibold text-gray-800">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="panel-icon"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
                    Уведомления
                </h2>
                <button id="close-notifications" class="p-2 rounded-md hover:bg-gray-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6L6 18"/><path d="M6 6L18 18"/></svg>
                </button>
            </div>
            <div id="notification-content" class="p-4 space-y-4 max-h-[80vh] overflow-y-auto">
                <!-- Уведомления будут здесь -->
            </div>
        </div>
    </div>
    
    <!-- Панель помощи (скрыта по умолчанию) -->
    <div id="help-panel" class="absolute top-0 right-0 z-50 w-96 max-w-full hidden">
        <div class="bg-white rounded-lg shadow-lg">
            <div class="flex items-center justify-between p-4 border-b">
                <h2 class="flex items-center gap-2 text-lg font-semibold text-gray-800">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="panel-icon"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
                    Помощь
                </h2>
                <button id="close-help" class="p-2 rounded-md hover:bg-gray-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6L6 18"/><path d="M6 6L18 18"/></svg>
                </button>
            </div>
            <div id="help-content" class="p-4 space-y-4 max-h-[80vh] overflow-y-auto">
                <div class="space-y-4">
                    <h3 class="font-semibold text-gray-800">Главная страница личного кабинета</h3>
                    <ul class="list-disc list-inside space-y-2 text-sm text-gray-700">
                        <li>📊 Отслеживайте статистику ваших объектов: активные, завершенные и общее количество</li>
                        <li>🔔 Следите за уведомлениями в правом верхнем углу - там появляются важные сообщения</li>
                        <li>⚡ Используйте быстрые действия для заказа услуг, просмотра документов или редактирования профиля</li>
                        <li>📋 В разделе 'Последние объекты' видны ваши недавние заказы с актуальными статусами</li>
                        <li>💬 Данные автоматически синхронизируются с нашей CRM-системой</li>
                    </ul>
                </div>
                <div class="border-t pt-4">
                    <h3 class="font-semibold text-gray-800">Контактная информация</h3>
                    <div class="space-y-3 mt-2 text-sm">
                        <div class="flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-phone h-4 w-4 text-green-600"><path d="M22 16.92v3a2 2 0 01-2.18 2A19.79 19.79 0 018.64 2.18a2 2 0 012.18-2h3a2 2 0 012 2v2a2 2 0 01-2 2a15.79 15.79 0 00-4 4a15.79 15.79 0 00-4 4a2 2 0 012 2h2a2 2 0 012 2v2a2 2 0 01-2 2h-3a2 2 0 01-2-2"/></svg>
                            <span class="font-medium">8 (495) 127 75-73</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin h-4 w-4 text-blue-600 mt-0.5"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0116 0z"/><circle cx="12" cy="10" r="3"/></svg>
                            <span>г. Орехово-Зуево, ул. Бабушкина д.2а, 5 этаж, офис 10</span>
                        </div>
                    </div>
                </div>
                <div class="border-t pt-4">
                    <h4 class="font-medium mb-2 text-gray-800">Нужна консультация?</h4>
                    <p class="text-sm text-gray-600 mb-3">
                        Свяжитесь с нами для получения бесплатной консультации и точного расчета стоимости услуг
                    </p>
                    <a href="tel:84951277573" class="inline-flex items-center justify-center w-full px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-phone mr-2 h-4 w-4"><path d="M22 16.92v3a2 2 0 01-2.18 2A19.79 19.79 0 018.64 2.18a2 2 0 012.18-2h3a2 2 0 012 2v2a2 2 0 01-2 2a15.79 15.79 0 00-4 4a15.79 15.79 0 00-4 4a2 2 0 012 2h2a2 2 0 012 2v2a2 2 0 01-2 2h-3a2 2 0 01-2-2"/></svg>
                        Позвонить
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Флаг для отслеживания загрузки данных
            let dataLoaded = false;
            
            // Заглушка данных
            const objectsData = [
                { id: 'obj1', address: 'г. Орехово-Зуево, ул. Ленина, д. 10', status: 'in_progress', service_name: 'Межевой план', created_at: '2023-10-26T10:00:00Z', manager_name: 'Иван', message_count: 5, user_id: 'user123' },
                { id: 'obj2', address: 'г. Павловский Посад, ул. Мира, д. 5', status: 'completed', service_name: 'Технический план', created_at: '2023-09-15T12:30:00Z', manager_name: 'Сергей', message_count: 2, user_id: 'user123' },
                { id: 'obj3', address: 'г. Воскресенск, ул. Октябрьская, д. 20', status: 'new', service_name: 'Геодезия', created_at: '2023-11-01T08:45:00Z', manager_name: 'Елена', message_count: 0, user_id: 'user123' },
                { id: 'obj4', address: 'г. Шатура, ул. Советская, д. 5', status: 'in_progress', service_name: 'Межевой план', created_at: '2023-10-20T14:00:00Z', manager_name: 'Иван', message_count: 1, user_id: 'user123' },
            ];
            
            const servicesData = [
                { id: 's1', name: 'Межевой план', description: 'Оформление межевого плана для постановки на кадастровый учет', base_price: 15000, cadastral_required: true },
                { id: 's2', name: 'Технический план', description: 'Изготовление технического плана для зданий и сооружений', base_price: 18000, cadastral_required: true },
                { id: 's3', name: 'Геодезическая съемка', description: 'Проведение геодезических изысканий на участке', base_price: 12000, cadastral_required: false },
                { id: 's4', name: 'Акт обследования', description: 'Подготовка акта обследования для снятия объекта с кадастрового учета', base_price: 8000, cadastral_required: true },
            ];

            const notificationsData = [
                { id: 'notif1', title: 'Статус заказа обновлен', message: 'Статус вашего заказа #20230501 на услугу "Межевой план" изменен на "Завершен".', type: 'info', created_at: '2023-11-20T15:00:00Z' },
                { id: 'notif2', title: 'Остаток по счету', message: 'На вашем счету осталось 1200 ₽. Пожалуйста, пополните счет для продолжения работ.', type: 'alert', created_at: '2023-11-19T10:00:00Z' },
            ];

            const profileData = {
                first_name: 'Андрей',
                last_name: 'Петров',
                middle_name: 'Сергеевич',
                phone: '+79998887766',
                email: 'andrey.petrov@example.com',
                payment_method: 'bank_transfer',
                document_delivery: 'sdek',
            };

            const personalData = {
                passport_series: '1234',
                passport_number: '567890',
                passport_issued_by: 'ГУ МВД России по г. Москве',
                passport_issued_date: '2015-05-20',
                passport_registration_address: 'г. Москва, ул. Тверская, д.1, кв.1',
            };
            
            const promoCodes = [
                { code: 'SKIDKA10', discount_type: 'percentage', discount_value: 10 },
                { code: 'SUPER500', discount_type: 'fixed', discount_value: 500 },
            ];
            
            // Функция для рендеринга объектов
            function renderObjects(data, containerId) {
                const container = document.getElementById(containerId);
                if (!container) return;
                
                container.innerHTML = '';
                
                if (data.length === 0) {
                    container.innerHTML = `
                        <div class="bg-white p-6 rounded-lg shadow-sm text-center text-gray-500">
                            <p>У вас пока нет активных объектов.</p>
                        </div>
                    `;
                    return;
                }
                
                data.forEach(object => {
                    let statusColor;
                    switch(object.status) {
                        case 'new': statusColor = 'bg-gray-200 text-gray-800'; break;
                        case 'in_progress': statusColor = 'bg-blue-200 text-blue-800'; break;
                        case 'completed': statusColor = 'bg-green-200 text-green-800'; break;
                        case 'cancelled': statusColor = 'bg-red-200 text-red-800'; break;
                        default: statusColor = 'bg-gray-200 text-gray-800';
                    }

                    const objectHtml = `
                        <div class="bg-white p-4 rounded-lg shadow-sm">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-md font-medium text-gray-800">${object.address}</h3>
                                <span class="text-xs font-semibold px-2 py-1 rounded-full ${statusColor}">${object.status === 'new' ? 'Новый' : object.status === 'in_progress' ? 'В работе' : object.status === 'completed' ? 'Завершен' : 'Отменен'}</span>
                            </div>
                            <div class="space-y-1 text-sm text-gray-600">
                                <div class="flex items-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text h-4 w-4"><path d="M14.5 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>
                                    <span>${object.service_name}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar h-4 w-4"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
                                    <span>Заказ от: ${new Date(object.created_at).toLocaleDateString()}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user h-4 w-4"><path d="M19 21v-2a4 4 0 00-4-4H9a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                                    <span>Менеджер: ${object.manager_name}</span>
                                </div>
                            </div>
                            <div class="flex gap-2 mt-4">
                                <button class="bg-gray-200 text-gray-700 px-3 py-1 rounded-md text-sm hover:bg-gray-300 transition duration-300 preview-doc-btn" data-id="${object.id}">
                                    Документы
                                </button>
                                <button class="bg-gray-200 text-gray-700 px-3 py-1 rounded-md text-sm hover:bg-gray-300 transition duration-300 open-chat-btn" data-id="${object.id}">
                                    Чат (${object.message_count})
                                </button>
                            </div>
                        </div>
                    `;
                    container.innerHTML += objectHtml;
                });
            }

            // Функция для рендеринга каталога услуг
            function renderServicesCatalog(data, containerId) {
                const container = document.getElementById(containerId);
                if (!container) return;
                
                container.innerHTML = '';

                if (data.length === 0) {
                    container.innerHTML = `
                        <div class="bg-white p-6 rounded-lg shadow-sm text-center text-gray-500">
                            <p>Услуги временно недоступны. Обратитесь к менеджеру.</p>
                        </div>
                    `;
                    return;
                }

                data.forEach(service => {
                    const serviceHtml = `
                        <div class="bg-white p-6 rounded-lg shadow-sm">
                            <h3 class="text-lg font-semibold text-gray-800">${service.name}</h3>
                            <p class="text-sm text-gray-600 mt-2">${service.description}</p>
                            <div class="border-t mt-4 pt-4">
                                <div class="flex justify-between items-center">
                                    <span>Стоимость:</span>
                                    <span class="font-bold">от ${service.base_price.toLocaleString()} ₽</span>
                                </div>
                            </div>
                            <button class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-300 w-full mt-4 order-service-btn" data-id="${service.id}">
                                Оформить заказ
                            </button>
                        </div>
                    `;
                    container.innerHTML += serviceHtml;
                });
            }

            // Функция для заполнения формы профиля
            function populateProfileForm(data) {
                if (data) {
                    document.getElementById('last_name').value = data.last_name;
                    document.getElementById('first_name').value = data.first_name;
                    document.getElementById('middle_name').value = data.middle_name;
                    document.getElementById('phone').value = data.phone;
                    document.getElementById('email').value = data.email;
                    document.getElementById('payment-method').value = data.payment_method;
                    document.getElementById('document-delivery').value = data.document_delivery;
                }
            }

            // Функция для заполнения формы паспортных данных
            function populatePersonalDataForm(data) {
                if (data) {
                    document.getElementById('passport_series').value = data.passport_series;
                    document.getElementById('passport_number').value = data.passport_number;
                    document.getElementById('passport_issued_by').value = data.passport_issued_by;
                    document.getElementById('passport_issued_date').value = data.passport_issued_date;
                    document.getElementById('passport_registration_address').value = data.passport_registration_address;
                }
            }

            // Функция для рендеринга уведомлений
            function renderNotifications(data) {
                const container = document.getElementById('notification-content');
                if (!container) return;
                
                container.innerHTML = '';
                if (data.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-gray-500">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bell-off mx-auto h-12 w-12 text-gray-400"><path d="M19 19H5c-1.1 0-2-.9-2-2v-4"/><path d="M19 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/><line x1="2" x2="22" y1="2" y2="22"/></svg>
                            <h3 class="mt-2 text-sm font-medium text-gray-900">Нет уведомлений</h3>
                            <p class="mt-1 text-sm text-gray-500">Все уведомления прочитаны</p>
                        </div>
                    `;
                    return;
                }

                data.forEach(notification => {
                    let typeColor;
                    switch(notification.type) {
                        case 'info': typeColor = 'bg-blue-100 text-blue-800'; break;
                        case 'alert': typeColor = 'bg-yellow-100 text-yellow-800'; break;
                        case 'error': typeColor = 'bg-red-100 text-red-800'; break;
                        default: typeColor = 'bg-gray-100 text-gray-800';
                    }

                    const notificationHtml = `
                        <div class="p-3 border rounded-lg">
                            <div class="flex items-start justify-between gap-2">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-1">
                                        <h4 class="font-medium text-sm">${notification.title}</h4>
                                        <span class="text-xs font-semibold px-2 py-0.5 rounded-full ${typeColor}">${notification.type}</span>
                                    </div>
                                    <p class="text-sm text-gray-600">${notification.message}</p>
                                    <p class="text-xs text-gray-500 mt-1">${new Date(notification.created_at).toLocaleString('ru-RU')}</p>
                                </div>
                                <button class="mark-as-read text-gray-500 hover:text-gray-700" data-id="${notification.id}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle h-4 w-4"><path d="M22 11.08V12a10 10 0 11-5.93-8.64"/><path d="M9 11l3 3L22 4"/></svg>
                                </button>
                            </div>
                        </div>
                    `;
                    container.innerHTML += notificationHtml;
                });

                document.querySelectorAll('.mark-as-read').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        const updatedData = notificationsData.filter(n => n.id !== id);
                        notificationsData.splice(0, notificationsData.length, ...updatedData);
                        renderNotifications(notificationsData);
                    });
                });
            }

            // Логика переключения вкладок
            const tabLinks = document.querySelectorAll('.tab-link');
            const tabContents = document.querySelectorAll('.tab-content');

            function showTab(tabId) {
                tabContents.forEach(content => {
                    content.classList.add('hidden');
                    content.classList.remove('active');
                });
                document.getElementById(tabId).classList.remove('hidden');
                document.getElementById(tabId).classList.add('active');

                tabLinks.forEach(link => {
                    link.classList.remove('bg-gray-200');
                });
                document.querySelector(`.tab-link[data-tab="${tabId}"]`).classList.add('bg-gray-200');
            }
            
            tabLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tabId = e.currentTarget.dataset.tab;
                    showTab(tabId);
                    
                    // Закрываем боковую панель на мобильных устройствах
                    const sidebar = document.getElementById('sidebar');
                    if (sidebar.classList.contains('open')) {
                        sidebar.classList.remove('open');
                    }
                });
            });

            // Логика боковой панели
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const sidebarClose = document.getElementById('sidebar-close');
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            
            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.add('open');
            });
            sidebarClose.addEventListener('click', () => {
                sidebar.classList.remove('open');
            });

            // Логика панелей уведомлений и помощи
            const notificationsToggle = document.getElementById('notifications-toggle');
            const helpToggle = document.getElementById('help-toggle');
            const notificationsPanel = document.getElementById('notification-panel');
            const helpPanel = document.getElementById('help-panel');
            const closeNotificationsBtn = document.getElementById('close-notifications');
            const closeHelpBtn = document.getElementById('close-help');

            notificationsToggle.addEventListener('click', () => {
                notificationsPanel.classList.toggle('hidden');
                helpPanel.classList.add('hidden');
                if (!notificationsPanel.classList.contains('hidden') && !dataLoaded) {
                     renderNotifications(notificationsData);
                }
            });
            
            helpToggle.addEventListener('click', () => {
                helpPanel.classList.toggle('hidden');
                notificationsPanel.classList.add('hidden');
            });

            closeNotificationsBtn.addEventListener('click', () => {
                notificationsPanel.classList.add('hidden');
            });
            
            closeHelpBtn.addEventListener('click', () => {
                helpPanel.classList.add('hidden');
            });

            // Логика синхронизации с CRM
            const syncCrmBtn = document.getElementById('sync-crm-btn');
            const syncResultAlert = document.getElementById('sync-result-alert');

            syncCrmBtn.addEventListener('click', () => {
                syncResultAlert.classList.add('hidden');
                syncCrmBtn.disabled = true;
                syncCrmBtn.innerHTML = `
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Синхронизация...
                `;

                setTimeout(() => {
                    const success = Math.random() > 0.3;
                    const resultMessage = success ? 'Данные успешно синхронизированы.' : 'Ошибка синхронизации. Попробуйте снова.';
                    const resultColor = success ? 'border-green-400 bg-green-50 text-green-700' : 'border-red-400 bg-red-50 text-red-700';

                    syncResultAlert.querySelector('p').textContent = resultMessage;
                    syncResultAlert.className = `rounded-lg border px-4 py-3 text-sm ${resultColor}`;
                    syncResultAlert.classList.remove('hidden');
                    
                    syncCrmBtn.disabled = false;
                    syncCrmBtn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw mr-2 h-4 w-4"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.79 2.87L3 7"/><path d="M3 3v4h4"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.79-2.87L21 17"/><path d="M21 21v-4h-4"/></svg>
                        Синхронизировать с CRM
                    `;
                }, 2000);
            });

            // Логика применения промокода
            const applyPromoBtn = document.getElementById('apply-promo-btn');
            applyPromoBtn.addEventListener('click', () => {
                const promoCodeInput = document.getElementById('promo-code-input').value.toUpperCase();
                const promoMessage = document.getElementById('promo-message');
                const discountRowEl = document.getElementById('discount-row');
                const discountCodeEl = document.getElementById('discount-code');
                const discountAmountEl = document.getElementById('discount-amount');
                const finalAmountEl = document.getElementById('final-amount');
                const totalAmount = 15000;

                const promo = promoCodes.find(p => p.code === promoCodeInput);
                let discountAmount = 0;
                
                if (promo) {
                    if (promo.discount_type === 'percentage') {
                        discountAmount = totalAmount * (promo.discount_value / 100);
                    } else {
                        discountAmount = promo.discount_value;
                    }
                    const finalAmount = totalAmount - discountAmount;
                    
                    discountCodeEl.textContent = promo.code;
                    discountAmountEl.textContent = `- ${discountAmount.toLocaleString()} ₽`;
                    finalAmountEl.textContent = `${finalAmount.toLocaleString()} ₽`;
                    
                    discountRowEl.classList.remove('hidden');
                    promoMessage.textContent = 'Промокод успешно применен!';
                    promoMessage.className = 'text-sm mt-2 text-green-600';
                } else {
                    // Сброс к исходным значениям
                    discountRowEl.classList.add('hidden');
                    finalAmountEl.textContent = `${totalAmount.toLocaleString()} ₽`;
                    
                    promoMessage.textContent = 'Неверный промокод';
                    promoMessage.className = 'text-sm mt-2 text-red-600';
                }
            });

            // Инициализация при загрузке страницы
            renderObjects(objectsData, 'objects-list');
            renderObjects(objectsData.slice(0, 2), 'objects-list-dashboard');
            renderServicesCatalog(servicesData, 'services-catalog');
            populateProfileForm(profileData);
            populatePersonalDataForm(personalData);
            dataLoaded = true;
        });
    </script>
</body>
</html>
